<?xml version="1.0"?>
<odoo>
    <record id="patient_form" model="ir.ui.view">
        <field name="name">Patient Form</field>
        <field name="model">hospital.patient</field>
        <field name="arch" type="xml">
            <form string="Patient" copy="0" delete="0">
                <sheet>
                    <field name="image" widget="image" class="oe_avatar"/>
                    <div class="oe_title">
                        <h4>
                            <field name="ref"/>
                        </h4>
                        <h1>
                            <label for="name" string="name" class="oe_edit_only"/>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="date_of_birth"/>
                            <field name="gender"/>
                            <field name="age"/>
                        </group>
                        <group>
                            <field name="appointment_count"/>
                            <field name="notes"/>
                            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                            <field name="active" invisible="1"/>
                        </group>
                    </group>
                    <group string="Other Information" name="patient_other_info">
                        <group>
                            <field name="parent_name" attrs="{'invisible': [('age', '>=', 18)]}"/>
                            <field name="marital_status" attrs="{'invisible': [('age', '&lt;', 18)]}"/>
                            <field name="partner_name" attrs="{'readonly': [('marital_status', '!=', 'married')],
                                        'required': [('marital_status', '=', 'married')]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Appointments" name="patient_appointments">
<!--                            <button name="%(hospital_app.action_add_appointment)d" string=" Add Appointment"-->
<!--                                    type="action"-->
<!--                                    context="{'default_patient_id': active_id, 'hide_patient_id': '1'}"-->
<!--                                    class="fa fa-plus btn-info"/>-->
                        <field name="appointment_ids" readonly="0"
                               context="{'default_patient_id': active_id, 'hide_patient_id': '1'}"
                               domain="[('state', '==', 'canceled')]">
                            <tree decoration-warning="state == 'in_consultation'" decoration-info="state  == 'draft'"
                                  decoration-danger="state == 'canceled'" decoration-success="state == 'done'"
                                  editable="bottom" delete="false">
                                <field name="ref"/>
                                <field name="doctor_id" widget="many2one_avatar_user"/>
                                <field name="appointment_time"/>
                                <field name="booking_time"/>
                                <field name="activity_ids" widget="list_activity"/>
                                <field name="state" widget="badge"
                                       decoration-warning="state == 'in_consultation'"
                                       decoration-info="state  == 'draft'"
                                       decoration-danger="state == 'canceled'"
                                       decoration-success="state == 'done'"/>
                                <button name="action_done" class="fa fa-check btn-success" string=" " type="object"
                                        attrs="{'invisible': [('state', '!=', 'in_consultation')]}"/>
                                <button name="%(hospital_app.action_cancel_appointment)d" string=" " states="draft"
                                        type="action"
                                        context="{'default_appointment_id': active_id, 'hide_appointment_id': '1'}"
                                        class="fa fa-times btn-danger"
                                        attrs="{'invisible': [('state', 'in', ('done', 'canceled', 'in_consultation', ' '))]}"/>
                            </tree>

                        </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" groups="base.group_user"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="patient_tree" model="ir.ui.view">
        <field name="name">Patient List</field>
        <field name="model">hospital.patient</field>
        <field name="arch" type="xml">
            <tree export_xlsx="0">
                <field name="name"/>
                <field name="ref"/>
                <field name="date_of_birth"/>
                <field name="age"/>
                <field name="gender"/>
                <field name="notes" optional="hide"/>
                <field name="active" invisible="1"/>
            </tree>
        </field>
    </record>
    <record id="patient_search" model="ir.ui.view">
        <field name="name">Patient Search</field>
        <field name="model">hospital.patient</field>
        <field name="arch" type="xml">
            <search string="Patients">
                <field name="name" filter_domain="['|', ('name','ilike',self), ('ref','ilike',self)]" string="Patients"/>
                <field name="age" />
                <field name="ref" />
                <field name="gender" />
                <filter string="Male" name="filter_male" domain="[('gender', '=', 'male')]"/>
                <filter string="Female" name="filter_female" domain="[('gender', '=', 'female')]"/>
                <filter string="Archived" name="filter_archived" domain="[('active', '=', False)]"/>
                <searchpanel>
                    <field name="gender" string="Gender" enable_counters="1" context="{}"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <record id="action_patient" model="ir.actions.act_window">
        <field name="name">Patient</field>
        <field name="res_model">hospital.patient</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Add a new Patient
            </p>
            <p>
                Customer is GOD and treat them properly.
            </p>
        </field>
    </record>

    <menuitem id="menu_patient_details"
              name="Patients"
              action="action_patient"
              parent="hospital_menu_root"
              sequence="5"
    />

    <!--        <record id="action_patient_female" model="ir.actions.act_window">-->
    <!--        <field name="name">Patient Female</field>-->
    <!--        <field name="res_model">hospital.patient</field>-->
    <!--        <field name="view_mode">tree,form</field>-->
    <!--        <field name="domain">[('gender', '=', 'female')]</field>-->
    <!--        <field name="context">{'default_gender': 'female', default_age': 25, 'hide_gender': 1}</field>-->
    <!--        <field name="help" type="html">-->
    <!--            <p class="o_view_nocontent_smiling_face">-->
    <!--                Add a new Female Patient-->
    <!--            </p>-->
    <!--            <p>-->
    <!--                Customer is GOD and treat them properly.-->
    <!--            </p>-->
    <!--        </field>-->
    <!--    </record>-->
    <!--    <menuitem id="menu_patient_female"-->
    <!--              name="Patient Female"-->
    <!--              action="action_patient_female"-->
    <!--              parent="menu_patient_details"-->
    <!--              sequence="10"-->
    <!--    />-->

</odoo>
